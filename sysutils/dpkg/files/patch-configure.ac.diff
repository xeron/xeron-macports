--- configure.ac.orig	2015-04-09 14:40:47.000000000 -0700
+++ configure.ac	2015-04-30 02:39:40.000000000 -0700
@@ -11,10 +11,10 @@

 AC_USE_SYSTEM_EXTENSIONS

-AM_INIT_AUTOMAKE([1.11 foreign nostdinc no-dist-gzip dist-xz])
+AM_INIT_AUTOMAKE([1.11 dejagnu foreign nostdinc no-dist-gzip dist-xz tar-ustar -Wall])
 AM_SILENT_RULES([yes])

-AM_GNU_GETTEXT_VERSION([0.18.2])
+AM_GNU_GETTEXT_VERSION([0.18.3])
 AM_GNU_GETTEXT([external])
 DPKG_DIST_CHECK([test "$GMSGFMT" = ":" && test "$USE_NLS" = "yes"],
                 [gettext required when NLS support enabled])
@@ -44,14 +44,33 @@
 DPKG_DEB_PROG_TAR

 # Checks for programs.
-AC_PROG_CC
+AM_PROG_AR
+if test "x$CC" = "x"; then
+  test -z "$CC"
+  AC_PROG_CC
+else
+  test ! -z "$CC"
+  export CC
+  AC_SUBST([CC])
+fi
 DPKG_C_C99
 AC_PROG_CXX
 DPKG_CXX_CXX11
-AC_PROG_LEX
-DPKG_DIST_CHECK([test "$LEX" = ":"], [lex program required])
-AC_CHECK_PROGS([DOXYGEN], [doxygen])
-AC_CHECK_PROG([HAVE_DOT], [dot], [YES], [NO])
+if test "x$INSTALL" = "x"; then
+  test -z "$INSTALL"
+  AC_PROG_INSTALL
+  AM_PROG_INSTALL_STRIP
+else
+  test ! -z "$INSTALL"
+  export INSTALL
+  AC_SUBST([INSTALL])
+fi
+AM_PROG_LEX
+DPKG_DIST_CHECK([test "$LEX" = ":"],[lex program required])
+AC_CHECK_PROGS([DOXYGEN],[doxygen])
+AC_CHECK_PROG([HAVE_DOT],[dot],[YES],[NO])
+AX_CHECK_GNU_MAKE
+AC_PATH_PROG([TAR],[gnutar gtar tar])
 DPKG_PROG_PO4A
 DPKG_PROG_PERL
 DPKG_PROG_POD2MAN
@@ -59,6 +78,8 @@

 # Checks for operating system services and capabilities.
 AC_SYS_LARGEFILE
+AC_OBJEXT
+AC_EXEEXT

 # Checks for libraries.
 DPKG_LIB_ZLIB
@@ -79,17 +100,36 @@
                   sys/proc.h sys/pstat.h linux/fiemap.h])

 # Checks for typedefs, structures, and compiler characteristics.
+AC_HEADER_STDBOOL
 AC_C_BIGENDIAN
 AC_C_CONST
+AC_C_FLEXIBLE_ARRAY_MEMBER
 AC_C_INLINE
+AC_C_PROTOTYPES
+AC_C_VARARRAYS
 AC_C_VOLATILE
+AC_TYPE_INT16_T
+AC_TYPE_INT32_T
+AC_TYPE_INT8_T
 AC_TYPE_MODE_T
+AC_FUNC_OBSTACK
+AC_TYPE_OFF_T
 AC_TYPE_PID_T
 AC_TYPE_SIZE_T
+AC_TYPE_SSIZE_T
+AC_CHECK_MEMBERS([struct stat.st_rdev])
+AC_CHECK_DECLS([sys_siglist])
+AC_TYPE_UINT16_T
+AC_TYPE_UINT32_T
+AC_TYPE_UINT64_T
+AC_TYPE_UINT8_T
+AC_TYPE_UID_T
 DPKG_TYPES_U_INT_T
 DPKG_TYPE_PTRDIFF_T
 AC_CHECK_SIZEOF([unsigned int])
+AC_CHECK_ALIGNOF([unsigned int])
 AC_CHECK_SIZEOF([unsigned long])
+AC_CHECK_ALIGNOF([unsigned long])
 DPKG_DECL_SYS_SIGLIST
 DPKG_DECL_SYS_ERRLIST

@@ -108,17 +148,28 @@
 DPKG_CHECK_COMPAT_FUNCS([getopt getopt_long obstack_free \
                          strnlen strndup strerror strsignal asprintf \
                          scandir alphasort unsetenv])
+AC_FUNC_CHOWN
+AC_FUNC_ERROR_AT_LINE
+AC_FUNC_FORK
+AC_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK
+AC_FUNC_MALLOC
+AC_FUNC_MMAP
+AC_FUNC_REALLOC
+AC_FUNC_STRNLEN
 AC_CHECK_DECLS([strnlen], [[#include <string.h>]])
 AC_CHECK_FUNCS([memcpy lchown],
                [], [AC_MSG_ERROR([missing required function])])
-AC_CHECK_FUNCS([strtoimax isascii setsid getdtablesize \
-                getprogname getexecname lutimes \
-                fallocate posix_fallocate posix_fadvise])
+AC_CHECK_FUNCS([dup2 ftruncate getdtablesize getexecname \
+                getprogname gettimeofday isascii lutimes memchr memmove memset \
+                mkdir mkfifo munmap fallocate posix_fallocate posix_fadvise \
+                putenv regcomp rmdir select setenv setlocale \
+                setsid strcasecmp strchr strcspn strdup strncasecmp \
+                strpbrk strrchr strspn strstr strtoimax strtol])

 DPKG_MMAP

 # Checks for the build machinery.
-AC_DEFINE(LIBDPKG_VOLATILE_API, 1, [Acknowledge the volatility of the API.])
+AC_DEFINE(LIBDPKG_VOLATILE_API, [1], [Acknowledge the volatility of the API.])
 DPKG_COMPILER_WARNINGS
 DPKG_COMPILER_OPTIMISATIONS
 DPKG_LINKER_OPTIMISATIONS
